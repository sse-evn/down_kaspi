"use strict";function _objectValues(o){for(var t=[],e=Object.keys(o),i=0;i<e.length;i++)t.push(o[e[i]]);return t}function _toConsumableArray(o){return _arrayWithoutHoles(o)||_iterableToArray(o)||_unsupportedIterableToArray(o)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(o,t){var e;if(o)return"string"==typeof o?_arrayLikeToArray(o,t):"Map"===(e="Object"===(e=Object.prototype.toString.call(o).slice(8,-1))&&o.constructor?o.constructor.name:e)||"Set"===e?Array.from(o):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?_arrayLikeToArray(o,t):void 0}function _iterableToArray(o){if("undefined"!=typeof Symbol&&null!=o[Symbol.iterator]||null!=o["@@iterator"])return Array.from(o)}function _arrayWithoutHoles(o){if(Array.isArray(o))return _arrayLikeToArray(o)}function _arrayLikeToArray(o,t){(null==t||t>o.length)&&(t=o.length);for(var e=0,i=new Array(t);e<t;e++)i[e]=o[e];return i}window.ddlShopPcm={init:function(){var o=this;o.isFlag=!0,o.$testUseGroup=+$.cookie("test.user.group"),o.$InfinityBlock=$(".shopBlock__section.LIST_INFINITY"),o.bindScrollEventToWindow(),o.bindEventClickForADVTBlock(),o.prepareShopSectionsForPushToDdl(),0<$(".shopBlock__section").length&&(o.pushPcmRecommendation(),o.bindDdlEventToButtonForBlocksPcm())},bindEventClickForADVTBlock:function(){var o=this;$(".shopBlock__section.ADVT").on("click",function(){o.pushDdlForADVTBlock($(this),"click")})},bindDdlEventToButtonForBlocksPcm:function(){var n=this;$(".shopBlock__link-more").add(".ks-link-more").on("click",function(){var t=$(this).parents(".shopBlock__section"),o=$(t).attr("objectid"),e=[].slice.call($(".startSection__wrapper[data-name]")).findIndex(function(o){return $(o).is("#block_SHOP")}),i=[].slice.call($(".shopBlock__section")).findIndex(function(o){return $(o).is($(t))}),e={name:"Clicked Link In Shop Block Footer",action:"Clicked Link In Shop Block Footer",category:"kaspi.kz - shop",block_position:i+e,block_type:n.detectBlockType(t),block_id:o,block_name:$(t).find(".shopBlock__header").text().trim(),block_source:"pcm"};++i&&(e.shop_block_position=i),$(t).hasClass("LIST_INFINITY")&&(e.logic_id=$(t).data("logic-id")),_objectValues(e).every(function(o){return o})&&digitalData.events.push(e)})},bindDdlEventToButtonForBlocksDy:function(){var n=this;$(".ks-link-more").on("click",function(){var t=$(this).parents(".ks-section"),o=$(t).attr("id"),e=[].slice.call($(".startSection__wrapper[data-name]")).findIndex(function(o){return $(o).is("#block_SHOP")}),i=[].slice.call($(".ks-section")).findIndex(function(o){return $(o).is($(t))}),e={name:"Clicked Link In Shop Block Footer",action:"Clicked Link In Shop Block Footer",category:"kaspi.kz - shop",block_position:i+e,block_type:n.detectBlockType(t),block_id:o,block_name:$(t).find(".shopBlock__header").text().trim(),block_source:"dy"};++i&&(e.shop_block_position=i),$(t).hasClass("LIST_INFINITY")&&(e.logic_id=$(t).data("logic-id")),_objectValues(e).every(function(o){return o})&&digitalData.events.push(e)})},isScrolledIntoView:function(o){var t;if(o)return t=(o=o.getBoundingClientRect()).top,o=o.bottom,t<window.innerHeight&&0<=o},prepareShopSectionsForPushToDdl:function(){var o=this,t=(o.$shopBlockType="",$(".ks-section"),$(".shopBlock__section")),e=[];0<t.length&&(o.$shopBlockType="pcm",e=[].slice.call(t.not($(".viewed")))),e.length?"pcm"===o.$shopBlockType?ddlShopPcm.collectPcmEvent(e):ddlShopPcm.collectDyEvent(e):$(window).off("scroll",o.prepareShopSectionsForPushToDdl)},pushDdlForADVTBlock:function(o,t){t={event:"click"===t?"kaspi_main_clicked_promo_banner":"kaspi_main_viewed_promo_banner",parameters:{block_position:[1+_toConsumableArray($(".shopBlock__section")).findIndex(function(o){return $(o).hasClass("ADVT")})],block_type:["simple_banner"],block_name:["promo"],block_type_id:[$(o).attr("objectid")],campaign_id:[$(".shopBlock__card",o).data("product-id")]}};window.mobapp&&"function"==typeof window.mobapp.logAnalyticEvent&&($(o).addClass("viewed"),mobapp.logAnalyticEvent(JSON.stringify(t)))},collectPcmEvent:function(o){var n=this;o.forEach(function(t){var o,e,i;n.isScrolledIntoView(t)&&($(t).hasClass("ADVT")?n.pushDdlForADVTBlock(t):(o=$(t).attr("objectid"),i=[].slice.call($(".startSection__wrapper[data-name]")).findIndex(function(o){return $(o).is("#block_SHOP")}),i={name:"Viewed Shop Block On Main",action:"Viewed Shop Block On Main",category:"kaspi.kz - shop",block_position:(e=[].slice.call($(".shopBlock__section")).findIndex(function(o){return $(o).is($(t))}))+i,block_type:n.detectBlockType(t),block_id:o,block_name:$(t).find(".shopBlock__header").text().trim(),block_source:"pcm"},++e&&(i.shop_block_position=e),$(t).hasClass("LIST_INFINITY")&&(i.logic_id=$(t).data("logic-id")),_objectValues(i).every(function(o){return o})&&(n.$eventShop=i,digitalData.events.push(i),$(t).addClass("viewed"))))})},collectDyEvent:function(o){var c=this;o.forEach(function(t){var o,e,i,n;c.isScrolledIntoView(t)&&(o="ks-categories"===$(t).attr("id"),e=$(t).attr("id"),n=[].slice.call($(".startSection__wrapper[data-name]")).findIndex(function(o){return $(o).is("#block_SHOP")}),n={name:"Viewed Shop Block On Main",action:"Viewed Shop Block On Main",category:"kaspi.kz - shop",block_position:(i=[].slice.call($(".ks-section")).findIndex(function(o){return $(o).is($(t))}))+n,shop_block_position:++i,block_type:o?"categories":c.detectDyBlockType(t),block_id:e,block_name:$(t).find("header").text().trim(),block_source:"dy"},$(t).hasClass("LIST_INFINITY")&&(n.logic_id=$(t).data("logic-id")),_objectValues(n).every(function(o){return o})&&(c.$eventShop=n,digitalData.events.push(n),$(t).addClass("viewed")))})},detectBlockType:function(o){o=$(o).data("block-type");if(o)return{GOODS_LIST:"products",LIST6:"subcategories",LIST4:"custom",LIST_INFINITY:"recommendations",LIST_CATEGORY:"categories"}[o]||void 0},detectDyBlockType:function(o){o=$(o);return o.find(".ks-container").hasClass("_ks-grid")?"recommendations":o.find(".ks-container").hasClass("_ks-2")?"custom":o.find(".ks-container").hasClass("_ks-3")?"subcategories":o.find(".ks-container").hasClass("_ks-scroll")?"products":void 0},pushPcmRecommendation:function(){var e=this;[].slice.call($(".shopBlock__section")).forEach(function(o){var t=[].slice.call($(".ddl_card",o)),o={listId:"pcm_"+e.detectBlockType(o)+"_objectid="+$(o).attr("objectid"),listName:$(o).find(".shopBlock__header").text().trim()},i=[];t.forEach(function(o,t){var e=$(o).find(".shopBlock__title").length,e={id:$(o).data("product-id"),name:(e?$(o).find(".shopBlock__title"):$(o).find(".ks-nav__item-title")).text().trim(),position:++t+"",categoryId:$(o).data("category-id"),url:$(o).attr("href")};i.push(e)}),o.items=i,window.digitalData=window.digitalData||{},window.digitalData.recommendation=window.digitalData.recommendation||[],window.digitalData.recommendation.push(o)})},pushDyRecommendation:function(){var n=this;[].slice.call($(".ks-section")).forEach(function(o){var i,t="ks-categories"===$(o).attr("id"),e=t?"categories":n.detectDyBlockType(o),t=t?[].slice.call($(".ks-nav__item-link",o)):[].slice.call($(".ks-card",o)),o={listId:"dy_"+e+"_objectid="+$(o).attr("id"),listName:$(o).find("header").text().trim()};"products"!==e&&"recommendations"!=e&&(i=[],t.forEach(function(o,t){var e=$(o).find(".ks-card__title").length,e={id:$(o).data("product-id"),name:(e?$(o).find(".ks-card__title"):$(o).find(".ks-nav__item-title")).text().trim(),position:++t+"",url:$(o).attr("href")};i.push(e)}),o.items=i,window.digitalData=window.digitalData||{},window.digitalData.recommendation=window.digitalData.recommendation||[],window.digitalData.recommendation.push(o))})},bindScrollEventToWindow:function(){$(window).on("scroll",this.prepareShopSectionsForPushToDdl)}},window.ddlShopPcm.init();